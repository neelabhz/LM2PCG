# 多选功能 (Multi-Select Feature)

## 概述
点云查看器现在支持**累积选择**模式：每次点击物体都会添加到选择列表，无需按住任何修饰键。

## 使用方法

### 基本操作
- **添加选择**: 直接点击任何物体，该物体会被添加到选择列表（高亮显示）
- **取消单个选择**: 再次点击已选中的物体，该物体会从选择列表中移除
- **保持选择**: 选择后的物体会一直保持选中状态，直到：
  - 再次点击该物体取消选择
  - 点击 "Clear All" 按钮清空所有选择
- **点击空白处**: 不会清空选择，保持当前选择状态

### 典型工作流程
1. 点击第一个物体 → 物体高亮，加入选择列表
2. 点击第二个物体 → 两个物体都高亮显示
3. 点击第三个物体 → 三个物体都高亮显示
4. 继续点击更多物体...
5. 不小心选错了？再次点击该物体即可取消
6. 完成选择后，点击 "Confirm All" 或 "Download All" 进行批量操作
7. 点击 "Clear All" 开始新的选择

### 视觉反馈
- 所有选中的点云会以**亮黄色**高亮显示
- 右侧 Inspector 面板显示所有选中物体的列表，包括：
  - 物体数量计数
  - 每个物体的名称和 object_code
  - 单独的删除按钮（✕）

### 批量操作

#### 1. 确认所有对象 (Confirm All)
- 点击 `✓ Confirm All (N)` 按钮
- 系统会并行调用 API 解析所有选中物体的 object_code
- 成功后返回包含所有物体信息的 JSON 数组
- JSON 输出到浏览器控制台，格式如下：
```json
{
  "total": 3,
  "successful": 3,
  "failed": 0,
  "results": [
    {
      "timestamp": "2025-10-27T...",
      "selection": {
        "code": "0-7-1",
        "type": "object",
        "name": "chair",
        "viewer_url": "...",
        "clicked_point": { ... }
      },
      "source_files": {
        "cluster_path": "...",
        "cluster_json": "..."
      }
    },
    // ... 更多物体
  ]
}
```

#### 2. 批量下载 (Download All)
- 点击 `💾 Download All (N)` 按钮
- 自动下载所有选中物体的源文件（PLY 格式）
- 如果尚未确认，会先自动调用 API 获取文件路径
- 下载之间有 200ms 延迟以避免浏览器阻止

## 技术实现

### 状态管理
- `pickedItems`: 数组存储所有选中物体的信息
- `selectedCloudIds`: Set 存储选中物体的 ID（用于高亮渲染）
- `sourceFileInfos`: 数组存储确认后的源文件信息

### 交互逻辑
1. 点击事件检测是否点击到有效物体
2. 如果点击到物体：
   - 已选中 → 从选择列表移除（toggle off）
   - 未选中 → 添加到选择列表（toggle on）
3. 如果点击空白处：保持当前选择不变
4. 只有 "Clear All" 按钮可以清空所有选择

### API 调用
- 使用 `Promise.all()` 并行处理多个 object_code
- 错误处理：记录失败的物体，继续处理成功的
- 返回分离的成功/失败结果

## 优势
1. **简化操作**: 无需记住和使用修饰键（Ctrl/Cmd）
2. **直观自然**: 点击即选择，再次点击即取消
3. **误操作友好**: 点击空白处不会丢失当前选择
4. **批量处理**: 支持批量下载源文件和确认
5. **灵活管理**: 可以单独移除选中的物体
6. **持久选择**: 选择保持稳定，直到主动清除

## 向后兼容
- 保留了所有原有功能
- 简化了交互方式，更加直观易用
- 适合需要多次选择和比较的工作流程
