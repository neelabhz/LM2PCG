# Session-Based User Selection - ä½¿ç”¨ç¤ºä¾‹

## æ¦‚è¿°

è¿™ä¸ªæœºåˆ¶å…è®¸ AI agent åœ¨éœ€è¦æ—¶æš‚åœæ‰§è¡Œï¼Œç­‰å¾…ç”¨æˆ·åœ¨ web viewer ä¸­é€‰æ‹©ç‰©ä½“ï¼Œç„¶åæ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ç»§ç»­æ‰§è¡Œã€‚

## Phase 1 åŸºç¡€æ¶æ„ - å·²å®Œæˆ âœ…

### ä¿®æ”¹çš„æ–‡ä»¶

1. **`ai_api_wrapper.py`**
   - æ‰©å±•äº† `VisOutput` schema æ·»åŠ  selection ç›¸å…³å­—æ®µ
   - `requires_selection`: æ˜¯å¦éœ€è¦ç”¨æˆ·é€‰æ‹©
   - `session_id`: é€‰æ‹©ä¼šè¯æ ‡è¯†ç¬¦
   - `selection_file`: é€‰æ‹©ç»“æœæ–‡ä»¶è·¯å¾„

2. **`mutli_room_agent2.py`**
   - æ–°å¢ `_wait_for_user_selection()` æ–¹æ³•
   - è½®è¯¢ `/tmp/viewer_selection_{session_id}.json` æ–‡ä»¶
   - æ”¯æŒè¶…æ—¶å’Œé”™è¯¯å¤„ç†

3. **`scripts/api_server.py`**
   - ä¿®æ”¹ `_handle_submit_selection()` æ”¯æŒä¸¤ç§æ ¼å¼ï¼š
     - Legacy: `[...selections...]` (æ•°ç»„)
     - New: `{"session_id": "...", "selections": [...]}`
   - Session-based é€‰æ‹©ä¿å­˜åˆ° `/tmp/viewer_selection_{session_id}.json`

4. **`scripts/test_realtime_selection.py`**
   - æ·»åŠ  `--session` å‚æ•°æ”¯æŒ session ID
   - æ›´æ–° `test_selection()` å‡½æ•°æ¥å— session_id

5. **`test_selection_wait.py`** (æ–°æ–‡ä»¶)
   - æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯ç­‰å¾…æœºåˆ¶
   - æ”¯æŒ mock æ¨¡å¼å’Œå®é™…ç­‰å¾…æ¨¡å¼

## ä½¿ç”¨æ–¹æ³•

### æµ‹è¯• 1: Mock æ¨¡å¼ï¼ˆè‡ªåŠ¨æµ‹è¯•ï¼‰

è¿™ä¸ªæ¨¡å¼ä¼šè‡ªåŠ¨åˆ›å»º mock selection æ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

```bash
# ç¡®ä¿æ•°æ®åº“å­˜åœ¨
python3 room_database.py

# è¿è¡Œ mock æµ‹è¯•
python3 test_selection_wait.py --mock
```

**é¢„æœŸè¾“å‡ºï¼š**
```
==================================================================
ğŸ§ª æµ‹è¯• Mock Selection (è‡ªåŠ¨åˆ›å»ºé€‰æ‹©æ–‡ä»¶)
==================================================================

ğŸš€ å¼€å§‹ç­‰å¾…ç”¨æˆ·é€‰æ‹©...
   Session ID: test_mock
   Mock æ–‡ä»¶å°†åœ¨ 3 ç§’åè‡ªåŠ¨åˆ›å»º

----------------------------------------------------------------------

â³ ç­‰å¾…ç”¨æˆ·åœ¨ viewer ä¸­é€‰æ‹©ç‰©ä½“...
   Session ID: test_mock
   è¶…æ—¶è®¾ç½®: 15 ç§’
   ç›‘æ§æ–‡ä»¶: /tmp/viewer_selection_test_mock.json
   (ç”¨æˆ·åœ¨ viewer ä¸­é€‰æ‹©åç‚¹å‡» 'Confirm' å³å¯ç»§ç»­)

   [Mock] ç­‰å¾… 3 ç§’ååˆ›å»º mock selection æ–‡ä»¶...
   [Mock] âœ… å·²åˆ›å»º mock æ–‡ä»¶: /tmp/viewer_selection_test_mock.json
âœ… æ”¶åˆ°ç”¨æˆ·é€‰æ‹©: 2 ä¸ªç‰©ä½“
   1. couch (0-7-12)
   2. table (0-7-15)

âœ… å·²æ¸…ç†ä¸´æ—¶æ–‡ä»¶: /tmp/viewer_selection_test_mock.json
----------------------------------------------------------------------

âœ… Mock æµ‹è¯•æˆåŠŸï¼
   æ”¶åˆ° 2 ä¸ªç‰©ä½“

ğŸ§¹ æ¸…ç†æµ‹è¯•æ–‡ä»¶: /tmp/viewer_selection_test_mock.json
```

### æµ‹è¯• 2: å®é™…ç­‰å¾…æ¨¡å¼ï¼ˆå¤šç»ˆç«¯åä½œï¼‰

è¿™ä¸ªæ¨¡å¼æ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼Œéœ€è¦æ‰‹åŠ¨å‘é€é€‰æ‹©ã€‚

#### Terminal 1: å¯åŠ¨ API Server

```bash
python3 scripts/api_server.py --port 8090
```

#### Terminal 2: å¯åŠ¨ç­‰å¾…æµ‹è¯•

```bash
python3 test_selection_wait.py
```

**è¾“å‡ºï¼š**
```
==================================================================
ğŸ§ª æµ‹è¯• Session-Based ç”¨æˆ·é€‰æ‹©ç­‰å¾…æœºåˆ¶
==================================================================

ğŸ“‹ æµ‹è¯•é…ç½®:
   Session ID: a1b2c3d4
   è¶…æ—¶è®¾ç½®: 30 ç§’
   ä¸´æ—¶æ–‡ä»¶: /tmp/viewer_selection_a1b2c3d4.json

ğŸš€ å¼€å§‹ç­‰å¾…ç”¨æˆ·é€‰æ‹©...

   æç¤º: åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©:
   python3 scripts/test_realtime_selection.py --session a1b2c3d4

----------------------------------------------------------------------

â³ ç­‰å¾…ç”¨æˆ·åœ¨ viewer ä¸­é€‰æ‹©ç‰©ä½“...
   Session ID: a1b2c3d4
   è¶…æ—¶è®¾ç½®: 30 ç§’
   ç›‘æ§æ–‡ä»¶: /tmp/viewer_selection_a1b2c3d4.json
   (ç”¨æˆ·åœ¨ viewer ä¸­é€‰æ‹©åç‚¹å‡» 'Confirm' å³å¯ç»§ç»­)

   ... ä»åœ¨ç­‰å¾…ç”¨æˆ·é€‰æ‹© (10/30ç§’)...
```

#### Terminal 3: æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©

**é€‰é¡¹ A: å•ä¸ªç‰©ä½“**
```bash
python3 scripts/test_realtime_selection.py --session a1b2c3d4
```

**é€‰é¡¹ B: å¤šä¸ªç‰©ä½“**
```bash
python3 scripts/test_realtime_selection.py --multi --session a1b2c3d4
```

**é€‰é¡¹ C: æ¸…ç©ºé€‰æ‹©**
```bash
python3 scripts/test_realtime_selection.py --clear --session a1b2c3d4
```

#### Terminal 2: çœ‹åˆ°ç»“æœ

```
âœ… æ”¶åˆ°ç”¨æˆ·é€‰æ‹©: 3 ä¸ªç‰©ä½“
   1. room_007 (0-7)
   2. room_003 (0-3)
   3. room_001 (0-1)

âœ… å·²æ¸…ç†ä¸´æ—¶æ–‡ä»¶: /tmp/viewer_selection_a1b2c3d4.json
----------------------------------------------------------------------

âœ… æµ‹è¯•æˆåŠŸï¼æ”¶åˆ°ç”¨æˆ·é€‰æ‹©:

   1. room_007
      Code: 0-7
      Type: room

   2. room_003
      Code: 0-3
      Type: room

   3. room_001
      Code: 0-1
      Type: room
```

#### Terminal 1 (API Server): çœ‹åˆ°æ—¥å¿—

```
============================================================
ğŸ¯ å®æ—¶æ£€æµ‹åˆ°ç”¨æˆ·é€‰æ‹©ï¼(Session: a1b2c3d4)
============================================================
âœ… ç”¨æˆ·é€‰æ‹©äº† 3 ä¸ªç‰©ä½“ï¼š

   1. room_007 (0-7)
   2. room_003 (0-3)
   3. room_001 (0-1)

ğŸ“¦ è¯¦ç»†ä¿¡æ¯ï¼š
[
  {
    "itemCode": "0-7",
    "displayName": "room_007",
    "type": "room",
    "sourceFile": "output/floor_0/room_007/mesh.ply",
    "timestamp": "2025-10-29T12:34:56.789Z"
  },
  ...
]
============================================================

ğŸ’¾ é€‰æ‹©å·²ä¿å­˜åˆ°: /tmp/viewer_selection_a1b2c3d4.json (session-specific)
âœ… æ–‡ä»¶å†™å…¥æˆåŠŸ
```

## å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Agent æ£€æµ‹åˆ°éœ€è¦ç”¨æˆ·é€‰æ‹©                                 â”‚
â”‚    - æŸ¥è¯¢æ­§ä¹‰ (å¤šä¸ª bedroom)                                â”‚
â”‚    - ä¸æ˜ç¡®æŒ‡ä»£ (the chair)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Agent ç”Ÿæˆå”¯ä¸€ session_id                                â”‚
â”‚    session_id = uuid.uuid4()[:8]  # e.g., "a1b2c3d4"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Agent æ‰“å¼€ Viewer (selection mode)                       â”‚
â”‚    URL: http://localhost:5173/?manifest=...                 â”‚
â”‚         &selectionMode=true                                 â”‚
â”‚         &sessionId=a1b2c3d4                                  â”‚
â”‚         &prompt=è¯·é€‰æ‹©æ‚¨æƒ³æŸ¥è¯¢çš„bedroom                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Agent è¿›å…¥ç­‰å¾…å¾ªç¯                                        â”‚
â”‚    _wait_for_user_selection(session_id, timeout=60)         â”‚
â”‚    - æ¯ç§’æ£€æŸ¥ä¸€æ¬¡æ–‡ä»¶                                        â”‚
â”‚    - æœ€å¤šç­‰å¾… 60 ç§’                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”¨æˆ·åœ¨ Viewer ä¸­æ“ä½œ                                      â”‚
â”‚    - ç‚¹å‡»é€‰æ‹©ç‰©ä½“                                            â”‚
â”‚    - ç‚¹å‡» "Confirm All" æŒ‰é’®                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Viewer POST åˆ° API Server                                â”‚
â”‚    POST /api/submit-selection                               â”‚
â”‚    Body: {                                                  â”‚
â”‚      "session_id": "a1b2c3d4",                              â”‚
â”‚      "selections": [...]                                    â”‚
â”‚    }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. API Server ä¿å­˜åˆ°æ–‡ä»¶                                    â”‚
â”‚    /tmp/viewer_selection_a1b2c3d4.json                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Agent æ£€æµ‹åˆ°æ–‡ä»¶                                          â”‚
â”‚    - è¯»å– JSON                                              â”‚
â”‚    - è§£æé€‰æ‹©ç»“æœ                                            â”‚
â”‚    - åˆ é™¤ä¸´æ—¶æ–‡ä»¶                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Agent ç»§ç»­æ‰§è¡Œ                                            â”‚
â”‚    - ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„ç‰©ä½“                                      â”‚
â”‚    - è°ƒç”¨ç›¸åº”å·¥å…· (CLR, VOL, BBD ç­‰)                        â”‚
â”‚    - è¿”å›æœ€ç»ˆç»“æœ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸‹ä¸€æ­¥ï¼šPhase 2 & 3

Phase 1 âœ… å·²å®ŒæˆåŸºç¡€æ¶æ„ã€‚ä¸‹ä¸€æ­¥éœ€è¦ï¼š

### Phase 2: Viewer é›†æˆ
- [ ] ä¿®æ”¹ `PointCloudView2.tsx` è§£æ URL å‚æ•°
  - `selectionMode`
  - `sessionId`
  - `prompt`
- [ ] å®ç° selection mode UI
  - æ˜¾ç¤ºæç¤ºä¿¡æ¯
  - é«˜äº®å€™é€‰ç‰©ä½“
- [ ] ä¿®æ”¹ POST è¯·æ±‚æ ¼å¼åŒ…å« `session_id`

### Phase 3: AI åˆ¤æ–­é€»è¾‘
- [ ] å®ç° `_needs_user_disambiguation()` æ–¹æ³•
- [ ] é›†æˆåˆ° `query()` ä¸»æµç¨‹
  - æ£€æµ‹æ­§ä¹‰æŸ¥è¯¢
  - å†³å®šæ˜¯å¦éœ€è¦ç­‰å¾…ç”¨æˆ·é€‰æ‹©
- [ ] æµ‹è¯•å„ç§åœºæ™¯

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: ç­‰å¾…è¶…æ—¶
**ç—‡çŠ¶**: Agent ä¸€ç›´ç­‰å¾…ï¼Œæœ€ç»ˆè¶…æ—¶

**å¯èƒ½åŸå› **:
- API server æœªè¿è¡Œ
- Session ID ä¸åŒ¹é…
- æ–‡ä»¶æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•**:
```bash
# æ£€æŸ¥ API server
curl http://localhost:8090/health

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åˆ›å»º
ls -la /tmp/viewer_selection_*.json

# æ‰‹åŠ¨æµ‹è¯•å†™å…¥
echo '[{"test": "data"}]' > /tmp/viewer_selection_test123.json
```

### é—®é¢˜ 2: æ–‡ä»¶æœªè¢«æ¸…ç†
**ç—‡çŠ¶**: `/tmp` ç›®å½•ä¸‹æœ‰å¾ˆå¤š `viewer_selection_*.json` æ–‡ä»¶

**è§£å†³æ–¹æ³•**:
```bash
# æ¸…ç†æ‰€æœ‰é€‰æ‹©æ–‡ä»¶
rm -f /tmp/viewer_selection_*.json
```

### é—®é¢˜ 3: æ— æ³•è¯»å–é€‰æ‹©æ–‡ä»¶
**ç—‡çŠ¶**: `JSONDecodeError` æˆ– `PermissionError`

**è§£å†³æ–¹æ³•**:
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /tmp/viewer_selection_*.json

# ä¿®å¤æƒé™
chmod 644 /tmp/viewer_selection_*.json
```

## API å‚è€ƒ

### `_wait_for_user_selection(session_id, timeout)`

**å‚æ•°:**
- `session_id` (str): å”¯ä¸€ä¼šè¯æ ‡è¯†ç¬¦
- `timeout` (int): æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 60

**è¿”å›:**
- `List[Dict]`: ç”¨æˆ·é€‰æ‹©çš„ç‰©ä½“åˆ—è¡¨
- `None`: è¶…æ—¶æˆ–å‡ºé”™

**ç¤ºä¾‹:**
```python
agent = FinalSpatialAIAgent()
result = agent._wait_for_user_selection("abc123", timeout=30)

if result:
    for item in result:
        print(f"é€‰æ‹©: {item['displayName']} ({item['itemCode']})")
else:
    print("ç”¨æˆ·æœªå®Œæˆé€‰æ‹©")
```

### POST `/api/submit-selection`

**Request Body (æ–°æ ¼å¼):**
```json
{
  "session_id": "a1b2c3d4",
  "selections": [
    {
      "itemCode": "0-7-12",
      "displayName": "couch",
      "type": "object",
      "sourceFile": "/path/to/file.ply",
      "timestamp": "2025-10-29T12:00:00Z"
    }
  ]
}
```

**Request Body (Legacy æ ¼å¼):**
```json
[
  {
    "itemCode": "0-7-12",
    "displayName": "couch",
    "type": "object",
    "sourceFile": "/path/to/file.ply",
    "timestamp": "2025-10-29T12:00:00Z"
  }
]
```

**Response:**
```json
{
  "success": true,
  "message": "Selection received",
  "count": 1,
  "session_id": "a1b2c3d4"
}
```
